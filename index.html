<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ArcGIS OAuth Redirect</title>
</head>
<body>
<script>
  const clientId = "kJb5xoqjKAHsY2ag"; // Replace with your client ID
  const redirectUri = window.location.origin + window.location.pathname;

  // ✅ Destination URL – replace with your target web app
  const baseDestinationUrl = "https://urbanize.maps.arcgis.com/apps/webappviewer/index.html?id=f6354f9fc1024799bc92dde2a0f10ae4";

  function handleAuth() {
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const token = params.get("access_token");

    if (token) {
      localStorage.setItem("arcgis_token", token);
      window.location.href = `${baseDestinationUrl}&token=${token}`;
      return;
    }

    const savedToken = localStorage.getItem("arcgis_token");
    if (savedToken) {
      window.location.href = `${baseDestinationUrl}&token=${savedToken}`;
      return;
    }

    const authUrl = new URL("https://www.arcgis.com/sharing/rest/oauth2/authorize");
    authUrl.searchParams.set("client_id", clientId);
    authUrl.searchParams.set("response_type", "token");
    authUrl.searchParams.set("redirect_uri", redirectUri);
    authUrl.searchParams.set("expiration", "20160");

    window.location.href = authUrl.toString();
  }

  handleAuth();
</script>
</body>
</html>

