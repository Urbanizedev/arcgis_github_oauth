<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ArcGIS OAuth Redirect</title>
</head>
<body>
  <h2>ArcGIS OAuth Redirect</h2>
  <div id="status">Authenticating...</div>

  <script>
    const clientId = "kJb5xoqjKAHsY2ag"; // Replace with your actual ArcGIS client ID
    const redirectUri = window.location.origin + window.location.pathname;

    function initiateOAuth() {
      const url = new URL("https://www.arcgis.com/sharing/rest/oauth2/authorize");
      url.searchParams.set("client_id", clientId);
      url.searchParams.set("response_type", "token");
      url.searchParams.set("redirect_uri", redirectUri);
      url.searchParams.set("expiration", "20160"); // 14 days

      // Redirect to ArcGIS login
      window.location.href = url.toString();
    }

    function getTokenFromHash() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const token = params.get("access_token");
      const expiresIn = params.get("expires_in");

      if (token) {
        localStorage.setItem("arcgis_access_token", token);
        document.getElementById("status").innerText =
          "Access token saved! You are now authenticated with ArcGIS.";
        console.log("Access Token:", token);
      } else {
        initiateOAuth(); // Start OAuth if no token
      }
    }

    window.onload = getTokenFromHash;
  </script>
</body>
</html>
